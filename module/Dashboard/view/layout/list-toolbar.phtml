<?php
//echo $this->controllerName();
switch ($this->controllerName()) {
    case 'Dashboard\Controller\User' :
        $titulo = "Administración de Usuarios";
        $enlace = "Nuevo Usuario";
        break;
    case 'Dashboard\Controller\Role' :
        $titulo = "Administración de Roles";
        $enlace = "Nuevo Rol";
        break;
    case 'Dashboard\Controller\Campana' :
        $titulo = "Administración de Campañas";
        $enlace = "Nueva Campaña";
        break;
    case 'Dashboard\Controller\Empresa' :
        $titulo = "Administración de Empresas";
        $enlace = "Nueva Empresa";
        break;
    case 'Dashboard\Controller\Pagobancario' :
        $titulo = "Administración de Pagos Bancarios";
        $enlace = "";
        break;
    default :
        $titulo = "";
        $enlace = "";
        break;
}
?>
<div class="panel panel-warning">
    <div class="panel-heading">
        <div>
            <div class="btn-group tabla-grilla">
                <span class="titulo-tabla-grilla">
                    <?php echo $titulo; ?>
                </span>
                <?php if( $enlace != "") { ?>
                <button class="btn btn-danger boton-nuevo-grilla" id="btnAdd" name="btnAdd" value="add"><span class="glyphicon glyphicon-open-file" aria-hidden="true"></span> <?php echo $enlace; ?>
                </button>
                <?php } ?>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade bs-example-modal-lg" id="modalPreview" tabindex="-1" role="dialog" aria-labelledby="modalPreviewLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="modalPreviewLabel">Preview Campaña</h4>
            </div>
            <div class="modal-body" id="bodyPreview">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modalContrato" tabindex="-1" role="dialog" aria-labelledby="modalContratoLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="modalContratoLabel">Generación de Contrato</h4>
            </div>
            <div class="modal-body" id="bodyContrato">
                <div class="container-fluid">
                    <form name="frmregistro_contrato" id="frmregistro_contrato" role="form">
                        <div class="form-group">
                            <label for="nombre" class="col-lg-5 control-label afiliacion">Nombre Contacto:</label>
                            <div class="col-xs-7 validacion"> 
                                <input type="hidden" class="form-control" name="id_empresa" id="id_empresa" value="" >
                                <input type="text" class="form-control" name="nombre" id="nombre" value="" >
                                <span class="help-block with-errors"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="email" class="col-lg-5 control-label afiliacion">Email Contacto:</label>
                            <div class="col-xs-7 validacion"> 
                                <input type="text" class="form-control" name="email" id="email" value="" >
                                <span class="help-block with-errors"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-xs-12 total">
                                <button type="button" class="btn btn-rebueno" name="generar_contrato" id="generar_contrato" onclick="javascript:generarcontrato();">Generar Contrato</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modalPagobancario" tabindex="-1" role="dialog" aria-labelledby="modalPagobancarioLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="modalPagobancarioLabel">Confirmación de Pago Bancario</h4>
            </div>
            <div class="modal-body" id="bodyPagobancario">
                <div class="container-fluid">
                    <form name="frmregistro_Pagobancario" id="frmregistro_Pagobancario" role="form">
                        <div class="form-group">
                            <label for="numero_operacion" class="col-lg-5 control-label afiliacion">Nro. Operación:</label>
                            <div class="col-xs-7 validacion"> 
                                <input type="hidden" class="form-control" name="id_cupon" id="id_cupon" value="" >
                                <input type="text" class="form-control" name="numero_operacion" id="numero_operacion" value="" >
                                <span class="help-block with-errors"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="email" class="col-lg-5 control-label afiliacion">Fecha operación:</label>
                            <div class="col-xs-7 validacion"> 
                                <input type="text" class="form-control" name="fecha_operacion" id="fecha_operacion" value="" >
                                <span class="help-block with-errors"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-xs-12 total">
                                <button type="button" class="btn btn-rebueno" name="generar_Pagobancario" id="generar_Pagobancario" onclick="javascript:generarpagobancario();">Registrar Pago Bancario</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>



<script type="text/javascript">

    function visualizar(campana){
        $.ajax({
            type: "POST",
            url: "/campana/preview",
            data: {id: campana},
            success: function (data) {
                $('#bodyPreview').html(data);
                $('#modalPreview').modal('show');
            }
        });
    }
    
    function registrarcontrato(empresa){
        $.ajax({
            type: "POST",
            url: "/dashboard/empresa/contrato",
            data: {id: empresa},
            success: function (data) {
                var contrato = $.parseJSON(data);
                if (contrato) {
                    if (contrato.id_contrato == -1) {
                        $('#id_empresa').val(empresa);
                        $('#modalContrato').modal('show');
                    } else {
                        var form = $('<form method="post" action="/dashboard/empresa/editarcontrato">' +
                                     '<input type="hidden" name="id_contrato" value="' + contrato.id_contrato + '">' +
                                     '</form>');
                        $(form).submit();
                    }
                }
            }
        });
    }
    
    function registrarpagobancario(cupon){
        $.ajax({
            type: "POST",
            url: "/dashboard/pagobancario/prepagado",
            data: {id: cupon},
            success: function (data) {
                var prepago = $.parseJSON(data);
                if (prepago) {
                    if (prepago.pagado == -1) {
                        $('#numero_operacion').val('');
                        $('#fecha_operacion').val('');
                    } else {
                        $('#numero_operacion').val(prepago.prepagado[0]);
                        $('#fecha_operacion').val(prepago.prepagado[1]);
                    } 
                    $('#id_cupon').val(cupon);
                    $('#modalPagobancario').modal('show');
                }
            }
        });
    }
    
    function generarcontrato(){
        var id_empresa = $("#id_empresa").val();
        var nombre = $("#nombre").val();
        var email = $("#email").val();

        $.ajax({
            type: "POST",
            url: "/dashboard/empresa/registrarcontrato",
            data: {id_empresa:id_empresa, nombre:nombre, email:email},
            success: function (data) {
                var contrato = $.parseJSON(data);
                if (contrato) {
                    if (contrato.id_contrato == -1) {
                        $('#modalContrato').modal('hide');
                    } else {
                        var form = $('<form method="post" action="/dashboard/empresa/editarcontrato">' +
                                     '<input type="hidden" name="id_contrato" value="' + contrato.id_contrato + '">' +
                                     '</form>');
                        $(form).submit();
                    }
                }
            }
        });
    } 
    
    function generarpagobancario(){
        var id_cupon         = $("#id_cupon").val();
        var numero_operacion = $("#numero_operacion").val();
        var fecha_operacion  = $("#fecha_operacion").val();

        $.ajax({
            type: "POST",
            url: "/dashboard/pagobancario/registrarpagobancario",
            data: {id_cupon:id_cupon, numero_operacion:numero_operacion, fecha_operacion:fecha_operacion},
            success: function (data) {
                var contrato = $.parseJSON(data);
                if (contrato) {
                    if (contrato.id_contrato == -1) {
                        $('#modalContrato').modal('hide');
                    } else {
                        var form = $('<form method="post" action="/dashboard/empresa/editarcontrato">' +
                                     '<input type="hidden" name="id_contrato" value="' + contrato.id_contrato + '">' +
                                     '</form>');
                        $(form).submit();
                    }
                }
            }
        });
    } 
</script>